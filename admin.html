<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tracking Dashboard</title>
<style>
body {
    margin: 0;
    display: flex;
    height: 100vh;
    font-family: Poppins;
    background: #0d1117;
    color: white;
}
.sidebar {
    width: 270px;
    background: #161b22;
    padding: 20px;
    overflow-y: auto;
}
.user {
    padding: 12px;
    margin: 10px 0;
    background: #21262d;
    border-radius: 8px;
    cursor: pointer;
}
#map {
    flex: 1;
}
</style>
</head>

<body>

<div class="sidebar" id="userList">
    <h2>Users</h2>
</div>

<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_MAP_API_KEY"></script>

<script type="module">
import { db } from './firebase.js';
import { ref, onValue } from 
"https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const userList = document.getElementById("userList");
let map, marker;

// Load all users list
onValue(ref(db, "locations"), (snapshot) => {
    userList.innerHTML = "<h2>Users</h2>";
    snapshot.forEach(child => {
        const id = child.key;
        const div = document.createElement("div");
        div.className = "user";
        div.innerText = id;
        div.onclick = () => loadMap(id);
        userList.appendChild(div);
    });
});

function loadMap(id) {
    onValue(ref(db, "locations/" + id), (snap) => {
        if (!snap.exists()) return;

        const d = snap.val();
        const pos = { lat: +d.latitude, lng: +d.longitude };

        if (!map) {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 16,
                center: pos
            });
            marker = new google.maps.Marker({
                position: pos,
                map: map
            });
        } else {
            marker.setPosition(pos);
            map.setCenter(pos);
        }
    });
}
</script>

</body>
</html>
